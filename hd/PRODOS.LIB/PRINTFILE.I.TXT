PROCEDURE PRINTFILE(VAR PATHNAME:PATHSTRING; SLOT, LEFTMARGIN, RIGHTMARGIN,
                       TOPMARGIN,BOTTOMMARGIN,CPI:INTEGER;
                       HEADER:FILESTRING);
CONST
   ALLBLANKS    = '                '; (* 16 BLANKS *)
   LINESPERINCH = 6;
   PAGEHEIGHT   = 66;   (* 11 INCH PAGE *)
   PAGEWIDTH    = 8;    (* INCHES *)
   FORMFEED     = 12;
   SPACING      =  1;

VAR
   I,J,K,
   LINESPERPAGE,
   LINEWIDTH,
   LINECOUNT,
   LEFTSPACING,
   TOPSPACING   :INTEGER;
   THISLINE     :ARRAY [1..80] OF CHAR;
   F            :TEXT;
   DONE         :BOOLEAN;

PROCEDURE ENABLE_PRINTER(X:INTEGER);
BEGIN
#A
 STX _T
 LDY #5
 LDA (_SP),Y
 JSR $FE95
 LDX _T
#
END;

PROCEDURE READLINE;
VAR I,J:INTEGER;
BEGIN
   J:=1;
   WHILE (NOT EOF(F)) AND (NOT EOLN(F)) AND (J<81) DO
   BEGIN
      THISLINE[J]:=F^;
      GET(F);
      J:=J+1
   END;
   FOR I:=J TO 80 DO THISLINE[I]:=' ';
   IF EOLN(F) THEN GET(F)
END;

PROCEDURE WRITE_LEFTMARGIN;
VAR I:INTEGER;
BEGIN
   IF LEFTSPACING <> 0 THEN FOR I:=1 TO LEFTSPACING DO WRITE(' ')
END;

PROCEDURE PRINT_THISLINE(START,STOP:INTEGER);
VAR I,J:INTEGER;
BEGIN
   WRITE_LEFTMARGIN;
   FOR J:= START TO STOP DO WRITE(THISLINE[J]);
   LINECOUNT := LINECOUNT+SPACING;
   IF (LINECOUNT >= LINESPERPAGE) THEN
   BEGIN
      WRITELN(CHR(FORMFEED));
      LINECOUNT := 0;
      IF TOPSPACING <> 0 THEN FOR I:=1 TO TOPSPACING DO WRITELN;
   END
   ELSE
   FOR I:=1 TO SPACING DO WRITELN
END;

BEGIN
   IF (SLOT > 0) AND (SLOT < 8) THEN
   BEGIN
      RESET(F,PATHNAME);
      LEFTSPACING := CPI * LEFTMARGIN;
      TOPSPACING  := LINESPERINCH * TOPMARGIN;
      LINEWIDTH   := (PAGEWIDTH - LEFTMARGIN - RIGHTMARGIN) * CPI;
      LINESPERPAGE:= (PAGEHEIGHT- TOPMARGIN - BOTTOMMARGIN) * LINESPERINCH;
      ENABLE_PRINTER(SLOT);
      IF HEADER <> ALLBLANKS THEN WRITE(HEADER);
      LINECOUNT:=0;
      IF TOPSPACING <> 0 THEN FOR I:=1 TO TOPSPACING DO WRITELN;
      WHILE NOT EOF(F) DO
      BEGIN
         READLINE;
         IF THISLINE[LINEWIDTH] = ' '
         THEN PRINT_THISLINE(1,LINEWIDTH-1)
         ELSE BEGIN
                J:=LINEWIDTH;
                REPEAT
                   J:=J-1
                UNTIL (THISLINE[J]=' ') OR (J=1);
                IF J=1 THEN J:=LINEWIDTH;
                PRINT_THISLINE(1,J);
                REPEAT
                   J:=J+1
                UNTIL (THISLINE[J]<>' ') OR (J=80);
                IF J<>80 THEN PRINT_THISLINE(J,80)
         END
      END;
      ENABLE_PRINTER(0);
   END
END;
