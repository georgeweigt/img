FUNCTION LOCK(VAR PATHNAME:PATHSTRING):INTEGER;
VAR RESULT:INTEGER;
BEGIN
#A
 STX _T
 LDY #9
 JSR MAKEPATH
 LDA _T+2
 STA LOKLIST+1
 LDA _T+3
 STA LOKLIST+2
 LDA #10
 STA LOKLIST
 JSR _MLI
 DB  $C4           ;GET_FILE_INFO
 DW  LOKLIST
 BNE LOK9
 LDA #1            ;READ ONLY
 STA LOKLIST+3
 LDA #7
 STA LOKLIST
 JSR _MLI
 DB  $C3           ;SET_FILE_INFO
 DW  LOKLIST
LOK9 LDY #5
 STA (_SP),Y
 INY
 LDA #0
 STA (_SP),Y
 LDY #9
 JSR RESTPATH
 LDX _T
#
 LOCK := RESULT
END;
#A
LOKLIST EQU *
 DB 10
 DS 17
;
 IFNDEF MAKEPATH
MAKEPATH EQU *
 LDA (_SP),Y    ;ADDRESS OF STRING ADDRESS
 STA _T+2
 INY
 LDA (_SP),Y
 STA _T+3
 LDY #64
MPTH1 LDA (_T+2),Y
 CMP #$20       ;SPACE?
 BNE MPTH2      ;NO. FOUND LAST CHAR OF PATHNAME
 DEY
 BPL MPTH1
 INY            ;Y=0
 TYA
 STA (_T+2),Y   ;MAKE LENGTH ZERO
 RTS
MPTH2 INY       ;PATH LENGTH
 STY PLENX
 DEY
MPTH3 LDA (_T+2),Y
 INY
 STA (_T+2),Y    ;MOVE STRING FORWARD ONE BYTE
 DEY
 DEY
 BPL MPTH3
 INY            ;Y=0
 LDA PLENX
 STA (_T+2),Y
 RTS
PLENX DS 1
 ENDIF
;
 IFNDEF RESTPATH
RESTPATH EQU *  ;RESTORE PATH @(_T+2)
 LDY #0
 LDA (_T+2),Y   ;LENGTH
 STA PLENX
 INY
RPTH1 LDA (_T+2),Y
 DEY
 STA (_T+2),Y   ;MOVE STRING BACK ONE BYTE
 INY
 INY
 DEC PLENX
 BPL RPTH1
 RTS
 ENDIF
#
