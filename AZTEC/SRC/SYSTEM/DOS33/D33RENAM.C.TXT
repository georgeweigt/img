/* Copyright (C) 1986 by Manx Software Systems, Inc. */
#include <errno.h>
#include <sgtty.h>
#include <device.h>
#include <dos33.h>

#define EBADNAME 0x40	/* ProDOS error code for bad file name */

rename(old, new)
char *old, *new;
{
	register struct _params *p, *_get_paramlist();
	register struct _buffers *b, *_get_buf();

	char name[30];

	if (_isdev(old) || _isdev(new)){
badname:
		errno = EBADNAME;
		return -1;
	}
	p = _get_paramlist();
	p->p_cmd = D33_RENAME;
	if (_get_name(new,p))
		goto badname;
	strncpy(name, _NAME, 30);
	*((char **)&p->p_record) = name;
	if (_get_name(old, p))
		goto badname;
	if ((b = _get_buf(p)) == 0){
		errno = EMFILE;
		return(-1);
	}
	_dos(1);
	_free_buf(b);
	if (p->p_return){
		errno = _errxlate(p->p_return);
		return -1;
	}
	return 0;
}

