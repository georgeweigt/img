/************************************************/
/*                                              */
/*  MORE  Copyright (C) 1990 by Phade Software  */
/*                                              */
/************************************************/

/* has to be linked with PH.LIB developed by Phade Software */

#include <stdio.h>

#define INV 15
#define NOR 14
#define EDI "VI"

int signal;

front ()
{
#asm
	lda #$0
	sta $57b
#endasm;
}

more ()
{
	int c;

	front ();
	printf ("%c more %c", INV, NOR);
	c = get_char ();
	if ((c == 209) || (c == 241)) signal = 1;
	if (c == 246) signal = 2;
	front ();
	printf ("       ");
	front ();
}

printit (fd, filename)
FILE *fd;
char *filename;
{
	char buf[256];
	int line;

	line = 0;
	while (fgets (buf, 256, fd))
	{
		if (feof (fd)) break;
		front ();
		qprintf (buf);
		line++;
		if (line == 23)
		{
			more ();
			if (signal == 1) break;
			if (signal == 2) break;
			line = 0;
		}
	}
	printf ("\n");
	free (buf);
}

main (argc,argv)
int argc;
char *argv[];
{
	FILE *fd;
	char *ed;
	char *getenv();
	int err;

	if (argc != 2)
	{
		printf ("\nusage : more file\n\n");
		exit (-1);
	}

	fd = fopen (argv[1], "r");
	if (fd == 0)
	{
		printf ("\nmore: can't open \"%s\" !\n\n", argv[1]);
		exit (-1);
	}

	signal = 0;
	printit (fd, argv[1]);
	fclose (fd);

	if (signal == 2)
	{
		ed = getenv ("EDITOR");
		if (ed == 0) err = execlp (EDI, EDI, argv[1], 0);
		else err = execlp (ed, ed, argv[1], 0);
		if (err = -1) printf ("\nmore: can't start editor\n\n");
	}

	exit (0);
}
